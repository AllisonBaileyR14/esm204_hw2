---
title: "ESM 204 HW2"
author: "Becca Reynolds"
date: "4/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(janitor)
library(here)
library(stats)
library(ggpubr)
library(hrbrthemes)
library(ggsci)

```


```{r}
#Read in hw2 data file
hw2_data <- read_csv("hw2_data.csv") %>% 
  clean_names() %>% 
  pivot_longer(c(mc_a, mc_b, mc_c, mc_d), names_to = "mc") 
  
num_data <- as.numeric(hw2_data$value, hw2_data$abatement)

```

1. Start with sector A.  Plot that sector’s marginal abatement cost estimates and write down a plausible functional form for the marginal cost of abatement. Use regression analysis to estimate the parameters of that function.  Repeating this for sectors B, C, and D will give you a model of the marginal cost of abatement function for each sector. How well do your models fit the data for each sector?  You may need to experiment with different functional forms, and you don’t necessarily have to assume the same function for each sector. Produce a plot of the estimated marginal abatement cost functions in all four sectors (this plot should go in your memo). 

```{r}

best_fit_a <- lm(value ~ abatement, filter(hw2_data, mc == "mc_a"))

best_fit_b <- lm(value ~ abatement, filter(hw2_data, mc == "mc_b"))

best_fit_c <- lm(value ~ abatement, filter(hw2_data, mc == "mc_c"))

best_fit_d <- lm(value ~ abatement, filter(hw2_data, mc == "mc_d"))

```

```{r}
mc_plot_1 <- ggplot(hw2_data, aes(x=abatement, y=value)) +
  geom_point(aes(color = mc)) +
  geom_abline(color = "#440154FF",intercept=coef(best_fit_a)[1],slope=coef(best_fit_a)[2]) +
  geom_abline(color = "#39568CFF",intercept=coef(best_fit_b)[1],slope=coef(best_fit_b)[2]) +
  geom_abline(color = "#1F968BFF",intercept=coef(best_fit_c)[1],slope=coef(best_fit_c)[2]) +
  geom_abline(color = "#73D055FF",intercept=coef(best_fit_d)[1],slope=coef(best_fit_d)[2]) +
  scale_color_manual(values = c("#440154FF", "#39568CFF", "#1F968BFF", "#73D055FF"), name = "Marginal Costs") +
  theme_gray() +
  theme(
    legend.position="right",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Carbon (ton)",
       y = "Price per ton",
       title = "Marginal Cost by Sector",
       subtitle = "Carbon Abatement") 

mc_plot_1

```


```{r}
mc_plot_2 <- ggplot(hw2_data, aes(x=abatement, y=value)) +
  geom_point(aes(color = mc)) +
  geom_smooth(alpha = .001, aes(lm = mc, color = mc)) +
  theme_gray() +
  theme(
    legend.position="right",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Carbon (ton)",
       y = "Price per ton",
       title = "Marginal Cost by Sector",
       subtitle = "Carbon Abatement") 
mc_plot_2
```

```{r}
mc_plot_3 <- ggplot(hw2_data, aes(sample = value)) +
  geom_qq(aes(color = mc),
                 alpha = 0.5,
                 show.legend = FALSE) +
  theme_gray() +
  theme(
    legend.position="right",
    plot.title = element_text(size=14)
  ) +
  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  ) +
  labs(x = "Carbon (ton)",
       y = "Price per ton",
       title = "Marginal Cost by Sector",
       subtitle = "Carbon Abatement") 

mc_plot_3
```

```{r}
formula <- y ~ poly(x, 3, raw = TRUE)

mc_plot_4 <- ggplot(hw2_data, aes(abatement, value, color = mc)) +
  geom_point() +
  stat_smooth(aes(fill = mc, color = mc), method = "lm", formula = formula) +
  stat_regline_equation(
    aes(label =  paste(..eq.label.., ..adj.rr.label.., sep = "~~~~")),
    formula = formula
  ) +
  theme_bw() 
# ggpar(p, palette = "jco")

mc_plot_4
```

```{r}
formula <- y ~ poly(x, 2, raw = TRUE)

mc_plot_5 <- ggplot(hw2_data, aes(abatement, value, color = mc)) +
  geom_point() +
  stat_smooth(aes( color = mc), method = "lm", formula = formula) +
  stat_regline_equation(
    aes(label =  paste(..eq.label.., ..adj.rr.label.., sep = "~~~~")),
    formula = formula,
    label.x = -1, label.y = 160
  ) +
  theme_bw() +
  scale_color_jco() +
  facet_wrap(~mc) +
   labs(x = "Carbon (ton)",
       y = "Price per ton",
       title = "Marginal Cost by Sector") +
  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  )
# ggpar(p, palette = "jco")

mc_plot_5

```

```{r}



sector_a = curve(0.45 + 0.56*(170-x)-0.00035*(170-x)^2, from=1, to=300, n=300, xlab="xvalue", ylab="yvalue", 
             col="#0073C2FF", lwd=2, main="Demand Curve Sector A")

sector_b = curve(-2 + 0.85*(200-x) - 0.0031*(200-x)^2, from=1, to=300, n=300, xlab="xvalue", ylab="yvalue", 
             col="#EFC000FF", lwd=2, add = TRUE, main="Demand Curve Sector B")

sector_c = curve(-7.9 + 0.32*(230-x) + 0.0054*(230-x)^2, from=1, to=300, n=300, xlab="xvalue", ylab="yvalue", 
             col="#868686FF", lwd=2, add = TRUE, main="Demand Curve Sector C")

sector_d = curve(2.1 - 0.06 *(300-x) + 0.0041*(300-x)^2, from=1, to=300, n=300, xlab="xvalue", ylab="yvalue", 
             col="yellow", lwd=2, add = TRUE, main="Demand Curve Sector D")


```

```{r}

sec_a <- function(Q){0.45 + 0.56*(170-Q)-0.00035*(170-Q)^2}

sec_b <- function(Q){-2 + 0.85*(200-Q) - 0.0031*(200-Q)^2}

sec_c <- function(Q){-7.9 + 0.32*(230-Q) + 0.0054*(230-Q)^2}

sec_d <- function(Q){2.1 - 0.06 *(300-Q) + 0.0041*(300-Q)^2}

sector_demand_plot <- ggplot(data = data.frame(x = 0), mapping = aes(x = x)) +
  stat_function(fun = sec_a, aes(color = "sec_a"), size = 2) +
  stat_function(fun = sec_b, aes(color = "sec_b"), size = 2) +
  stat_function(fun = sec_c, aes(color = "sec_c"), size = 2) +
  scale_color_jco() +
  xlim(0,300) +
  labs(x = "Carbon (ton)",
       y = "Price per ton",
       title = "Demand by Sector",
       subtitle = "Country X") +
  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'),
    plot.subtitle = element_text(hjust=0.5, vjust=0.5, face='italic')
  )


sector_demand_plot

```

